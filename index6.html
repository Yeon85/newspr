<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë‰´ìŠ¤&í™ë³´ â€“ ì¹´ë“œ ìŠ¬ë¼ì´ë” + ë³¸ë¬¸ ë”ë³´ê¸°</title>
<style>
  :root{ --bg:#f5f6f8; --card:#fff; --ink:#222; --ink2:#666; --line:#e9e9ee; --brand:#0b5bd3; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial,sans-serif;color:var(--ink)}
  .wrap{max-width:420px;margin:0 auto;padding:16px 12px 40px}
  .uploader{display:flex;gap:8px;align-items:center;margin-bottom:12px}
  .uploader input{display:none}
  .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:#fff;cursor:pointer}
  .hint{font-size:12px;color:var(--ink2)}

  .list{display:flex;flex-direction:column;gap:18px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:12px}

  /* ì¹´ë“œ ë‚´ ìŠ¬ë¼ì´ë” */
  .mini-slider{position:relative;border-radius:12px;overflow:hidden;background:#ddd}
  .mini-slides{display:flex;transition:transform .35s ease}
  .mini-slide{min-width:100%}
  .mini-slide img{display:block;width:100%;aspect-ratio:4/5;object-fit:cover}

  /* ì‚¬ì§„ ì•ˆ ë‚´ë¹„: ë‘ ë²ˆì§¸ ì¥ë¶€í„° */
  .mini-nav{position:absolute;top:50%;left:0;right:0;display:flex;justify-content:space-between;transform:translateY(-50%);pointer-events:none;opacity:0;transition:opacity .2s}
  .mini-nav button{pointer-events:auto;border:none;background:rgba(0,0,0,.35);color:#fff;width:32px;height:32px;border-radius:50%;cursor:pointer}
  .mini-slider.show-nav .mini-nav{opacity:1}

  /* ë„íŠ¸ëŠ” ì‚¬ì§„ ì•„ë˜ */
  .mini-dots{display:flex;gap:8px;justify-content:center;align-items:center;padding:10px 0 6px}
  .mini-dot{width:8px;height:8px;border-radius:50%;background:#cfd3da;cursor:pointer}
  .mini-dot.active{background:var(--brand)}

  /* ë³¸ë¬¸(ì¤„ì„ + ë”ë³´ê¸°) */
    .caption{
    margin-top:2px; font-size:14px; line-height:1.55; color:#222;
    display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:1;
    overflow:hidden;
  }
  .caption.expanded{
    -webkit-line-clamp:unset; display:block;
  }
  .more-btn{
    display:inline-flex; gap:4px; align-items:center;
    margin-top:6px; padding:4px 10px;
    border:1px solid var(--line); border-radius:999px;
    background:#fff; font-size:12px; color:#333; cursor:pointer;
  }
  .more-btn[hidden]{display:none !important}
  

</style>
</head>
<body>
<main class="wrap">
  <div class="uploader">
    <label class="btn" for="files">ğŸ“· ì‚¬ì§„ ì„ íƒ(ì—¬ëŸ¬ ì¥)</label>
    <input id="files" type="file" accept="image/*" multiple>
    <div class="hint">ë„íŠ¸ëŠ” ì‚¬ì§„ ì•„ë˜, â€¹ â€ºëŠ” ë‘ ë²ˆì§¸ ì¥ë¶€í„°, ë³¸ë¬¸ì€ íƒ­í•˜ë©´ ì „ì²´ ë³´ê¸°</div>
  </div>

  <section id="list" class="list"></section>
</main>

<script>
  /* ìƒ˜í”Œ ë°ì´í„° */
  const texts = [
    'ì¹´ë“œë‰´ìŠ¤ì— ê´€í•œ ë‚´ìš©ì„ ë³´ê²Œ í•˜ëŠ” ê³³. ì§‘ì£¼ì¸ì´ ì±„ë¬´ë¥¼ ì™„ì „íˆ ìƒí™˜í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ì±„ë¬´ë¥¼ ì™„ì „íˆ ìƒí™˜í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ì§‘ì£¼ì¸ì´ ì±„ë¬´ë¥¼ ì™„ì „íˆ ìƒí™˜í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œâ€¦',
    'ê¹¡ì„¸ê±°ë˜ ìœ„í—˜í•©ë‹ˆë‹¤. ì§‘ì£¼ì¸ì´ ì±„ë¬´ë¥¼ ì™„ì „íˆ ìƒí™˜í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œâ€¦ ë” ê¸´ ë³¸ë¬¸ì´ ê³„ì† ì´ì–´ì§‘ë‹ˆë‹¤. ë” ê¸´ ë³¸ë¬¸ì´ ê³„ì† ì´ì–´ì§‘ë‹ˆë‹¤.'
  ];
  let images = []; // {url,name}

  const listEl = document.getElementById('list');
  const fileInput = document.getElementById('files');

  fileInput.addEventListener('change', e=>{
    const files = [...e.target.files].filter(f=>f.type.startsWith('image/'));
    for(const f of files){ images.push({url:URL.createObjectURL(f), name:f.name}); }
    render();
  });

  function render(){
    const srcs = images.length ? images.map(i=>i.url) : [placeholder()];
    listEl.innerHTML = '';
    texts.forEach(txt=>{
      const card = document.createElement('article');
      card.className = 'card';
      card.innerHTML = `
        <div class="mini-slider" data-index="0">
          <div class="mini-slides"></div>
          <div class="mini-nav">
            <button class="mini-prev" aria-label="ì´ì „">â€¹</button>
            <button class="mini-next" aria-label="ë‹¤ìŒ">â€º</button>
          </div>
        </div>
        <div class="mini-dots"></div>

        <div class="caption-wrap">
          <div class="caption" tabindex="0" role="button" aria-expanded="false"></div>
          <button class="more-btn" type="button">â€¦ ë”ë³´ê¸°</button>
        </div>
      `;
      card.querySelector('.caption').textContent = txt;
      buildMiniSlider(card, srcs);
      makeExpandable(card);     // â† ì¤„ì„/ì „ì²´ë³´ê¸° ì ìš©
      listEl.appendChild(card);
    });
  }

  /* --- ìº¡ì…˜ ë”ë³´ê¸°/ì ‘ê¸° --- */
  function makeExpandable(card){
    const cap = card.querySelector('.caption');
    const btn = card.querySelector('.more-btn');

    // ì˜ë¦¼ ì—¬ë¶€ íŒë³„(ë Œë” ì§í›„ í•œ í”„ë ˆì„ ë’¤ì— ê²€ì‚¬)
    requestAnimationFrame(()=>{
      const isClamped = cap.scrollHeight > cap.clientHeight + 1;
      btn.hidden = !isClamped;             // ì˜ë¦¬ì§€ ì•Šìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€
      // ìº¡ì…˜ ì „ì²´ ì˜ì—­ í´ë¦­ìœ¼ë¡œë„ í† ê¸€
      const toggle = ()=>{
        const expanded = cap.classList.toggle('expanded');
        cap.setAttribute('aria-expanded', expanded);
        btn.textContent = expanded ? 'ì ‘ê¸°' : 'â€¦ ë”ë³´ê¸°';
      };
      btn.addEventListener('click', toggle);
      cap.addEventListener('click', toggle);
      cap.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); toggle(); }});
    });
  }

  /* --- ìŠ¬ë¼ì´ë” --- */
  function buildMiniSlider(card, srcs){
    const slider = card.querySelector('.mini-slider');
    const slidesEl = card.querySelector('.mini-slides');
    const dotsEl = card.querySelector('.mini-dots');

    slidesEl.innerHTML = '';
    dotsEl.innerHTML = '';

    srcs.forEach((src, i)=>{
      const s = document.createElement('div');
      s.className = 'mini-slide';
      s.innerHTML = `<img src="${src}" alt="ì´ë¯¸ì§€ ${i+1}">`;
      slidesEl.appendChild(s);

      const d = document.createElement('div');
      d.className = 'mini-dot';
      d.addEventListener('click', ()=> goTo(slider, i));
      dotsEl.appendChild(d);
    });

    card.querySelector('.mini-prev').addEventListener('click', ()=> goStep(slider, -1));
    card.querySelector('.mini-next').addEventListener('click', ()=> goStep(slider, +1));

    // ìŠ¤ì™€ì´í”„
    let startX=null;
    slidesEl.addEventListener('touchstart', e=>{ startX = e.touches[0].clientX; }, {passive:true});
    slidesEl.addEventListener('touchend', e=>{
      if(startX==null) return;
      const dx = e.changedTouches[0].clientX - startX;
      if(Math.abs(dx)>40) dx<0 ? goStep(slider, +1) : goStep(slider, -1);
      startX=null;
    }, {passive:true});

    setIndex(slider, 0);
  }

  function setIndex(slider, i){
    const slidesEl = slider.querySelector('.mini-slides');
    const total = slidesEl.children.length;
    const idx = Math.max(0, Math.min(total-1, i));
    slider.dataset.index = String(idx);
    slidesEl.style.transform = `translateX(${-idx*100}%)`;

    const dots = slider.parentElement.querySelectorAll('.mini-dot');
    dots.forEach((d,k)=> d.classList.toggle('active', k===idx));

    // ë‘ ë²ˆì§¸ ì¥ë¶€í„° â€¹ â€º í‘œì‹œ
    if (idx >= 1 && total > 1) slider.classList.add('show-nav');
    else slider.classList.remove('show-nav');

    slider.querySelector('.mini-prev').disabled = (idx===0);
    slider.querySelector('.mini-next').disabled = (idx===total-1);
  }
  const goTo = (slider, i)=> setIndex(slider, i);
  const goStep = (slider, step)=> setIndex(slider, (+slider.dataset.index||0)+step);

  function placeholder(){
    return "data:image/svg+xml;utf8," + encodeURIComponent(
      `<svg xmlns='http://www.w3.org/2000/svg' width='560' height='700'>
        <rect width='100%' height='100%' rx='12' fill='#dddddd'/>
        <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#333' font-size='28'>280Ã—350</text>
      </svg>`
    );
  }

  render();
</script>
</body>
</html>
